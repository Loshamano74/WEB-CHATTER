<!DOCTYPE html>
<html>
<head>
    <title>Login - Wi-Fi Messenger</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        .tab-content {
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <ul class="nav nav-tabs">
            <li class="nav-item">
                <a class="nav-link active" data-toggle="tab" href="#login">Login</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="tab" href="#register">Register</a>
            </li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane fade show active" id="login">
                <h1>Login - Wi-Fi Messenger</h1>
                {% if error %}
                    <p style="color: red;">Invalid username or password. Please try again.</p>
                {% endif %}
                <form id="loginForm" method="POST">
                    <label for="username">Username:</label><br>
                    <input type="text" id="username" name="username" required {% if remember %} value="{{ remembered_username }}" {% endif %}><br>
                    <label for="password">Password:</label><br>
                    <input type="password" id="password" name="password" required {% if remember %} value="{{ remembered_password }}" {% endif %}><br>
                    <input type="checkbox" id="rememberMe" name="rememberMe"> Remember Me<br>
                    <button type="submit" class="btn btn-primary">Login</button>
                </form>
            </div>
            <div class="tab-pane fade" id="register">
                <h1>Register - Wi-Fi Messenger</h1>
                <!-- Your registration form goes here -->
                <!-- Similar to the login form, but with different action -->
                <form method="POST" action="{{ url_for('index') }}">
                    <label for="new_username">Username:</label><br>
                    <input type="text" id="new_username" name="new_username" required><br>
                    <label for="new_password">Password:</label><br>
                    <input type="password" id="new_password" name="new_password" required><br>
                    <button type="submit" class="btn btn-primary">Register</button>
                </form>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        // Check if the "Remember Me" checkbox is checked and fill in the login form fields accordingly
        document.addEventListener('DOMContentLoaded', function () {
            var rememberMeCheckbox = document.getElementById('rememberMe');
            var rememberedUsername = getCookie('remembered_username');
            var rememberedPassword = getCookie('remembered_password');
            if (rememberMeCheckbox && rememberedUsername && rememberedPassword) {
                rememberMeCheckbox.checked = true;
                document.getElementById('username').value = rememberedUsername;
                document.getElementById('password').value = rememberedPassword;
            }
        });

        // Function to set a cookie
        function setCookie(name, value, days) {
            var expires = "";
            if (days) {
                var date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                expires = "; expires=" + date.toUTCString();
            }
            document.cookie = name + "=" + (value || "") + expires + "; path=/";
        }

        // Function to get a cookie
        function getCookie(name) {
            var nameEQ = name + "=";
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = cookies[i];
                while (cookie.charAt(0) == ' ') {
                    cookie = cookie.substring(1, cookie.length);
                }
                if (cookie.indexOf(nameEQ) == 0) {
                    return cookie.substring(nameEQ.length, cookie.length);
                }
            }
            return null;
        }

        // Function to handle form submission and set cookies if "Remember Me" is checked
        document.getElementById('loginForm').addEventListener('submit', function(event) {
            var rememberMeCheckbox = document.getElementById('rememberMe');
            if (rememberMeCheckbox && rememberMeCheckbox.checked) {
                var username = document.getElementById('username').value;
                var password = document.getElementById('password').value;
                setCookie('remembered_username', username, 7); // Set cookie for 7 days
                setCookie('remembered_password', password, 7); // Set cookie for 7 days
            } else {
                // Clear cookies if "Remember Me" is unchecked
                document.cookie = 'remembered_username=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
                document.cookie = 'remembered_password=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
            }
        });
    </script>
</body>
</html>
